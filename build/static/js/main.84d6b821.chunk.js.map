{"version":3,"sources":["components/upload.module.css","components/UploadVideo.js","utils/hostname.js","pages/Index.js","App.js","index.js"],"names":["module","exports","UploadVideo","props","useState","title","setTitle","content","setContent","warn","setWarn","upload","useRef","prograss","handleClose","className","styles","dialog_wrapper","onClick","dialog","e","stopPropagation","htmlFor","type","value","onChange","target","name","id","cols","rows","console","log","files","ref","accept","progress","submit","current","file","size","url","param","FormData","append","progressEl","style","width","axios","post","headers","onUploadProgress","progressEvent","complete","loaded","total","window","requestAnimationFrame","progressFn","parseInt","innerHTML","then","response","img","data","code","message","img_url","handleImgUrl","Index","isVisibleUpload","setIsVisibleUpload","imgList","setImgList","stylesLi","listStyle","marginTop","borderBottom","length","map","item","index","key","App","ReactDOM","render","StrictMode","document","getElementById"],"mappings":"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","file":"static/js/main.84d6b821.chunk.js","sourcesContent":["// extracted by mini-css-extract-plugin\nmodule.exports = {\"dialog_wrapper\":\"upload_dialog_wrapper__3IyZ1\",\"dialog\":\"upload_dialog__epJoY\",\"warn\":\"upload_warn__eAiC5\",\"submit\":\"upload_submit__526SI\",\"progress\":\"upload_progress__11w43\"};","import React, {useState, useRef} from 'react'\r\nimport  styles from  './upload.module.css';\r\nimport hostname from '../utils/hostname';\r\nimport axios from 'axios';\r\n\r\nconst UploadVideo = (props) => {\r\n    const [title, setTitle] = useState('')\r\n    const [content, setContent] = useState('')\r\n    const [warn, setWarn] = useState('')\r\n    const upload = useRef()\r\n    const prograss = useRef()\r\n\r\n    function handleChangeTitle(e) {\r\n        setTitle(e.target.value)\r\n    }\r\n\r\n    function handleChangeContent(e) {\r\n        setContent(e.target.value)\r\n    }\r\n\r\n    function handleClose() {\r\n        props.handleClose()\r\n    }\r\n\r\n    function handleStopPropagation(e) {\r\n        e.stopPropagation()\r\n    }\r\n\r\n    function handleUploadFile(e) {\r\n        console.log(e.target.files)\r\n    }\r\n\r\n    // 提交\r\n    function handleSubmit() {\r\n        if(!title) {\r\n            setWarn('标题未输入')\r\n            return\r\n        }\r\n        if(!content) {\r\n            setWarn('内容未输入')\r\n            return\r\n        }\r\n        if(!upload.current.files[0]) {\r\n            setWarn('未检测到上传文件')\r\n            return\r\n        }else {\r\n            let file = upload.current.files[0]\r\n            if(file.type !== 'video/mp4') {\r\n                setWarn('请上传mp4格式的视频')\r\n                return\r\n            }\r\n            if((file.size/1024/1024) > 50) {\r\n                setWarn('请上传小于50Mb的文件')\r\n                return\r\n            }\r\n\r\n            // 上传视频文件\r\n            let url = `${hostname}/upload/video`\r\n            let param = new FormData()\r\n            param.append('file', file)\r\n            param.append('title', title)\r\n            param.append('content', content)\r\n            // 进度条\r\n            console.log(prograss.current)\r\n            let progressEl = prograss.current\r\n            progressEl.style.width = '0'\r\n            axios.post(url, param, {\r\n                headers: {\r\n                  'Content-Type': 'multipart/form-data'\r\n                },\r\n                onUploadProgress: progressEvent => {\r\n                    let complete = (progressEvent.loaded / progressEvent.total * 100 | 0) + '%'\r\n                    window.requestAnimationFrame(progressFn)\r\n                    function progressFn() {\r\n                        if(parseInt(progressEl.style.width) < 200) {\r\n                            progressEl.style.width = complete * 200 + 'px';\r\n                            progressEl.innerHTML =  complete\r\n                            window.requestAnimationFrame(progressFn)\r\n                        }\r\n                    }\r\n                }\r\n            }).then((response) => {\r\n                if(response.data.code === 0) {\r\n                    console.log(response.data.message)\r\n                    handleImgUrl(response.data.img_url)\r\n                }\r\n            })\r\n        }\r\n    }\r\n\r\n    // 值传递给父组件\r\n    function handleImgUrl(img) {\r\n        handleClose()\r\n        props.handleImgUrl(img)\r\n    }\r\n\r\n    return (\r\n        <div className={styles.dialog_wrapper} onClick={handleClose}>\r\n            <div className={styles.dialog} onClick={handleStopPropagation}>\r\n                <label htmlFor=\"标题\">\r\n                    <span>标题</span>\r\n                    <input type=\"text\" value={title} onChange={handleChangeTitle} />\r\n                </label>\r\n                <label htmlFor=\"描述\">\r\n                    <span>描述</span>\r\n                    <textarea name=\"\" id=\"\" cols=\"30\" rows=\"10\" value={content} onChange={handleChangeContent}></textarea>\r\n                </label>\r\n                <label htmlFor=\"上传视频\">\r\n                    <span>上传视频</span>\r\n                    <input type=\"file\" onChange={handleUploadFile} ref={upload} name=\"file\" accept=\"video/mp4\"/>\r\n                </label>\r\n                <div className={styles.progress} ref={prograss}></div>\r\n                {warn ? <p className={styles.warn}>{warn}</p> : null}\r\n                <button className={styles.submit} onClick={handleSubmit}>提交</button>\r\n            </div>\r\n        </div>\r\n    )\r\n}\r\n\r\nexport default UploadVideo","let hostname = 'http://localhost:5000'\r\n\r\nexport default hostname","import React, { useState } from 'react';\r\nimport UploadVideo from '../components/UploadVideo';\r\n\r\nconst Index = () => {\r\n    const [isVisibleUpload, setIsVisibleUpload] = useState(false)\r\n    const [imgList, setImgList] = useState([])\r\n\r\n    function handleClick() {\r\n        setIsVisibleUpload(true)\r\n    }\r\n\r\n    function handleClose() {\r\n        setIsVisibleUpload(false)\r\n    }\r\n\r\n    function handleImgUrl(url) {\r\n        console.log(`fu ${url}`)\r\n        setImgList(imgList => [...imgList, url])\r\n        console.log(imgList)\r\n    }\r\n\r\n    const stylesLi = {\r\n        listStyle: 'none',\r\n        marginTop: 10 + 'px',\r\n        borderBottom: 1 + 'px',\r\n    }\r\n    return (\r\n        <div>\r\n            <p>请上传视频文件(仅支持mp4格式, 文件大小在50Mb以下)</p>\r\n            <button onClick={handleClick}>上传视频</button>\r\n            {isVisibleUpload ? <UploadVideo handleClose={handleClose} handleImgUrl={handleImgUrl}/> : null}\r\n            {imgList.length > 0 ? \r\n                <div>\r\n                    {imgList.map((item, index) => \r\n                        <li style={stylesLi} key={index}>{index+1}、 {item}</li>\r\n                    )}\r\n                </div>\r\n            : null}\r\n        </div>\r\n    )\r\n}\r\n\r\nexport default Index","import React from 'react';\nimport './App.css'\nimport Index from './pages/Index';\n\nfunction App() {\n    return (\n        <div className=\"App\">\n            <Index />\n        </div>\n    );\n}\n\nexport default App;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\n\nReactDOM.render(\n    <React.StrictMode>\n        <App />\n    </React.StrictMode>,\n    document.getElementById('root')\n);\n"],"sourceRoot":""}